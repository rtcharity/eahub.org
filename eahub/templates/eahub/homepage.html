{% extends 'base_bs5.html' %}

{% load static sekizai_tags crispy_forms_field %}

{% block title %}Home{% endblock %}

{% block navbar %}
    {% include 'components/navbar.html' %}
{% endblock %}

{% block content %}
    {% addtoblock 'body_classes' %}homepage home{% endaddtoblock %}

    <div class="container">
        <div class="row home__intro justify-content-center">
            <div class="col-sm-24 col-lg-8 order-1 order-lg-0 align-self-end">
                <h1>EA Hub</h1>
                <p class="home__subtitle">
                    A global directory for effective altruists to connect
                </p>
                <button type="button" id="signup-btn" class="btn btn-primary btn-lg btn-secondary">
                    Join the Community
                </button>
                <script>
                    document.addEventListener('DOMContentLoaded', () => {
                        document.querySelector('#signup-btn').addEventListener('click', () => {
                            document.querySelector('.join__title').scrollIntoView({behavior: 'smooth'});
                            setTimeout(() => {
                                document.querySelector('input[name="name"]').focus();
                            }, 600);
                        });
                    });
                </script>
            </div>
            <div class="col col-lg-16 d-flex justify-content-end">
                <img class="home__map" src="{% static 'global/images/home/map.svg' %}" alt="world map">
            </div>
        </div>
    </div>
    <div class="container home__hero">
        <div class="hero__img"
             style="background-image: url({% static "global/images/home/profiles-screen.webp" %})"
        ></div>
        <div class="container hero__text-wrap">
            <div class="row">
                <div class="col col-lg-9 offset-lg-13 hero__text">
                    <h2 class="hero__title">Community Directory</h2>
                    <p>Search our directory of thousands of EAs from around the world</p>
                    <a href="{% url 'profiles' %}" class="btn btn-outline-secondary btn-lg">Browse</a>
                </div>
            </div>
        </div>
    </div>
    <div class="container home__hero" data-image-pos="right">
        <div class="hero__img"
             style="background-image: url({% static "global/images/home/groups-screen.webp" %})"
        ></div>
        <div class="container hero__text-wrap">
            <div class="row">
                <div class="col col-lg-9 offset-lg-4 hero__text">
                    <h2 class="hero__title">Groups Directory</h2>
                    <p>Connect with local, national and virtual groups</p>
                    <a href="{% url 'groups' %}" class="btn btn-outline-secondary btn-lg">Browse</a>
                </div>
            </div>
        </div>
    </div>

    <div class="container join-community">
        <h2 class="join__title">Join the Community</h2>

        <div class="row row-cols-1 row-cols-lg-2">
            <div class="col order-2 order-lg-1 join__map-col">
                <div class="join__map-block" id="homepage-map"></div>
                <script defer>
                    async function loadMap() {
                        const response = await fetch({% url 'homepage_map' %});
                        const homepageMapElem = document.getElementById('homepage-map');
                        homepageMapElem.innerHTML = await response.text();

                        const scriptsNotExecuted = homepageMapElem.querySelectorAll('script');
                        Array.from(scriptsNotExecuted).forEach(scriptNotExecuted => {
                            const scriptToExecute = document.createElement('script');
                            Array
                                .from(scriptNotExecuted.attributes)
                                .forEach(
                                    attr => scriptToExecute.setAttribute(attr.name, attr.value
                                )
                            );
                            scriptToExecute.appendChild(document.createTextNode(scriptNotExecuted.innerHTML));
                            scriptNotExecuted.parentNode.replaceChild(scriptToExecute, scriptNotExecuted);
                        });
                    }

                    const homepageMapObserver = new window.IntersectionObserver(([entry]) => {
                        if (entry.isIntersecting) {
                            loadMap();
                            homepageMapObserver.disconnect();
                        }
                    }, {root: null, threshold: 0,});
                    homepageMapObserver.observe(document.querySelector('#homepage-map'));
                </script>
            </div>

            <div class="col order-1 order-lg-2 join__form-col">
                <form action="{% url 'account_signup' %}" method="post">
                    {% csrf_token %}

                    <input type="hidden" name="next" value="{% url 'my_profile_first_visit' %}" />

                    <div class="form-floating">
                        <input type="text"
                            class="form-control form-control-lg"
                            name="{{ form.name.name }}"
                            placeholder="Name"
                            id="{{ form.name.id }}"
                            required>
                        <label for="{{ form.name.id }}">Name</label>
                    </div>

                    <div class="form-floating">
                        <input type="email"
                            class="form-control form-control-lg"
                            name="{{ form.email.name }}"
                            placeholder="Email"
                            id="{{ form.email.id }}"
                            required>
                        <label for="{{ form.email.id }}">Email</label>
                    </div>

                    <div class="form-floating">
                        <input type="password"
                            class="form-control form-control-lg"
                            name="{{ form.password1.name }}"
                            placeholder="Password"
                            id="{{ form.password1.id }}"
                            required>
                        <label for="{{ form.password1.id }}">Password</label>
                    </div>

                    {% if form.captcha %}{% crispy_field form.captcha %}{% endif %}
                    
                    <button type="submit" class="btn btn-primary">Sign Up</button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block footer %}
    <footer>
        <div class="container">
            <div class="row footer__links">
                <div class="col col-24 col-md-12 col-lg-6">
                    <a class="footer__item" href="https://feedback.eahub.org" target="_blank">Post feedback</a>
                    <a class="footer__item" href="https://github.com/rtcharity/eahub.org/" target="_blank" rel="nofollow">
                        Source code
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                    <a class="footer__item" href="mailto:contact@eahub.org" target="_blank">contact@eahub.org</a>
                </div>
                <div class="col col-24 col-md-12 order-md-3 order-lg-2 col-lg-6">
                    <a class="footer__item" href="https://www.eawork.club/" target="_blank" rel="nofollow">
                        Opportunities Board
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                    <a class="footer__item" href="https://resources.eahub.org" target="_blank" rel="nofollow">
                        EA Resources
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                    <a class="footer__item" href="https://donationswap.eahub.org/" target="_blank" rel="nofollow">
                        EA Donation Swap
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                </div>
                <div class="col col-24 col-md-12 order-md-2 order-lg-3 col-lg-6">
                    <a class="footer__item" href="{% url 'about' %}">About us</a>
                    <a class="footer__item" href="{% url 'privacy_policy' %}">Privacy Policy</a>
                    <span class="footer__item">Effective Altruism Hub Â© {% now "Y" %}</span>
                </div>
            </div>
        </div>
    </footer>
{% endblock %}
