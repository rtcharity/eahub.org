{% extends 'base_bs5.html' %}

{% load static sekizai_tags crispy_forms_field socialaccount %}

{% block title %}Home{% endblock %}

{% block navbar %}
  {% include 'components/navbar.html' %}
{% endblock %}

{% block content %}
  {% addtoblock 'body_classes' %}homepage home{% endaddtoblock %}

  {% include 'includes/messages.html' with messages=messages %}

  <div class="container">
    <div class="row home__intro justify-content-center">
      <div class="col-sm-24 col-lg-8 order-1 order-lg-0 align-self-end">
        <h1>EA Hub</h1>
        <p class="home__subtitle">
          A global directory for effective altruists to connect
        </p>
        <button type="button" id="signup-btn"
          class="btn btn-primary btn-lg btn-secondary gtm-btn-join"
        >
          Join the Community
        </button>
        <script>
          document.addEventListener('DOMContentLoaded', () => {
            document.querySelector('#signup-btn').addEventListener('click', () => {
              document.querySelector('.join__title').scrollIntoView({behavior: 'smooth'});
              setTimeout(() => {
                document.querySelector('input[name="name"]').focus();
              }, 600);
            });
          });
        </script>
      </div>
      <div class="col col-lg-16 d-flex justify-content-end">
        <img class="home__map" src="{% static 'global/images/home/map.svg' %}"
          alt="world map"
        >
      </div>
    </div>
  </div>
  <div class="container home__hero">
    <div class="hero__img"
      style="background-image: url({% static "global/images/home/profiles-screen.webp" %})"
    ></div>
    <div class="container hero__text-wrap">
      <div class="row">
        <div class="col col-lg-9 offset-lg-13 hero__text">
          <h2 class="hero__title">Profiles Directory</h2>
          <p>Search our directory of thousands of EAs from around the world</p>
          <a href="{% url 'profiles' %}"
            class="btn btn-outline-secondary btn-lg"
          >Browse</a>
        </div>
      </div>
    </div>
  </div>
  <div class="container home__hero" data-image-pos="right">
    <div class="hero__img"
      style="background-image: url({% static "global/images/home/groups-screen.webp" %})"
    ></div>
    <div class="container hero__text-wrap">
      <div class="row">
        <div class="col col-lg-9 offset-lg-4 hero__text">
          <h2 class="hero__title">Groups Directory</h2>
          <p>Connect with local, national and virtual groups</p>
          <a href="{% url 'groups' %}" class="btn btn-outline-secondary btn-lg">Browse</a>
        </div>
      </div>
    </div>
  </div>

  <div class="container join-community">
    <h2 class="join__title">Join the Community</h2>

    <div class="row row-cols-1 row-cols-lg-2">
      <div class="col order-2 order-lg-1 join__map-col">
        <div class="join__map-block" id="homepage-map"></div>
        <script defer>
          async function loadMap() {
            const response = await fetch({% url 'homepage_map' %});
            const homepageMapElem = document.getElementById('homepage-map');
            homepageMapElem.innerHTML = await response.text();

            const scriptsNotExecuted = homepageMapElem.querySelectorAll('script');
            Array.from(scriptsNotExecuted).forEach(scriptNotExecuted => {
              const scriptToExecute = document.createElement('script');
              Array.from(scriptNotExecuted.attributes).forEach(
                attr => scriptToExecute.setAttribute(attr.name, attr.value
                )
              );
              scriptToExecute.appendChild(document.createTextNode(scriptNotExecuted.innerHTML));
              scriptNotExecuted.parentNode.replaceChild(scriptToExecute, scriptNotExecuted);
            });
          }

          const homepageMapObserver = new window.IntersectionObserver(([entry]) => {
            if (entry.isIntersecting) {
              loadMap();
              homepageMapObserver.disconnect();
            }
          }, {root: null, threshold: 0,});
          homepageMapObserver.observe(document.querySelector('#homepage-map'));
        </script>
      </div>

      <div class="col order-1 order-lg-2 join__form-col">
      
        <div class="join__sso">
          <a href="{% provider_login_url 'auth0' %}">
            <div class="sso__google-btn">
              <svg viewBox="0 0 700 1000">
                <path transform="scale(1,-1) translate(50,-860)"
                  horiz-adv-x="631" stroke-width="1"
                  d="M316 850c-174 0-316-141-316-315a315 315 0 0 1 77-207c0 0 24-29 40-87 14-53 53-83 107-83h53c30 0 56 6 149 150 17 27 37 69 49 105 19 63 5 101-10 123-18 24-48 39-80 39-24 0-49-16-69-34-16 18-39 35-65 35-35 0-66-16-85-43-23-32-26-76-8-124 17-45 56-91 85-120a28 28 0 0 1 40 38c-35 36-63 74-73 101-11 31-11 57 1 74 9 12 23 18 40 18 12 0 28-11 37-24a91 91 0 0 1-6-30c0-25 20-39 32-39 17 0 31 22 31 39a99 99 0 0 1-4 28c11 14 31 25 44 25 6 0 24-1 35-16s12-41 2-73c-8-27-25-62-41-90-36-60-69-95-88-115a33 33 0 0 0-26-11l-43 0c-29 0-45 13-53 41-19 71-50 108-52 110a260 260 0 1 0 456 170c0-65-24-134-63-179l0 0c-9-10-66-77-66-200 0-34-73-69-237-69a28 28 0 1 1 0-56c133 0 214-6 223-35-2-5-9-11-32-15-35-7-91-7-168-6h-23a28 28 0 1 1 0-56c130 0 194-3 229-56a28 28 0 0 1 47 30 155 155 0 0 1-42 43q29 13 40 37c4 4 6 22 6 24s-2 18-5 23c-8 22-26 36-51 46 57 27 69 64 69 90 0 107 49 160 51 163 1 0 1 0 1 1s0 0 0 0c48 55 77 136 77 215 0 174-142 315-315 315z"/>
              </svg>

              <span>Sign In with Effective Altruism SSO</span>
            </div>
          </a>
          <div class="sso__or">or</div>
        </div>

        <form action="{% url 'account_signup' %}" method="post">
          {% csrf_token %}

          <div class="form-floating">
            <input type="text"
              class="form-control form-control-lg"
              name="{{ form.first_name.name }}"
              placeholder="First Name"
              id="{{ form.first_name.id }}"
              required
            >
            <label for="{{ form.first_name.id }}">First Name</label>
          </div>

          <div class="form-floating">
            <input type="text"
              class="form-control form-control-lg"
              name="{{ form.last_name.name }}"
              placeholder="Last Name"
              id="{{ form.last_name.id }}"
              required
            >
            <label for="{{ form.last_name.id }}">Last Name</label>
          </div>

          <div class="form-floating">
            <input type="email"
              class="form-control form-control-lg"
              name="{{ form.email.name }}"
              placeholder="Email"
              id="{{ form.email.id }}"
              required
            >
            <label for="{{ form.email.id }}">Email</label>
          </div>

          <div class="form-floating">
            <input type="password"
              class="form-control form-control-lg"
              name="{{ form.password1.name }}"
              placeholder="Password"
              id="{{ form.password1.id }}"
              required
            >
            <label for="{{ form.password1.id }}">Password</label>
          </div>

          {% if form.captcha %}{% crispy_field form.captcha %}{% endif %}

          <button type="submit" class="btn btn-primary">Sign Up</button>
        </form>
      </div>
    </div>
  </div>
{% endblock %}

{% block footer %}
  {% include 'includes/footer.html' %}
{% endblock %}
