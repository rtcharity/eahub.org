on: [pull_request, workflow_dispatch]
services:
    image: postgres
    env:
        - POSTGRES_USER: postgres
        - POSTGRES_PASSWORD: postgres
        - POSTGRES_BD: postgres
    ports:
        - 5432:5432
    options: --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5
jobs:
    pytest:
        name: run code styles checks & tests
        runs-on: ubuntu-latest
        steps:
            - name: git clone the current branch
              uses: actions/checkout@v2
            - name: run pytest
              shell: bash
              run: docker-compose run --use-aliases web pytest
