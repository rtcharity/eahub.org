{% extends 'base.html' %}

{% load thumbnail %}

{% block content %}

<br><br>

<div class="container animated">
  <div class="row profile-head">
    <div class="col-xs-12 col-md-2">
      {% thumbnail profile.image "200x200" crop="center" as im %}
        <img class="profile_picture" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
      {% empty %}
        <img class="profile_picture" src="/static/images/profile_Avatar10.png">
      {% endthumbnail %}
    </div>
    <div class="col-xs-12 col-md-6">
      <h1>{{ profile.full_name|title }}</h1>
      <div class="btn btn-default purple">
        {% if user.id == profile.id %}
          <a href="{% url 'edit_profile' %}"><i class="fa fa-pencil"></i> Edit</a>
        {% else %}
          <span><i class="fa fa-envelope"></i> Message</span>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<br><br>
<div class="container profile">
  <div class="row">
    <div class="col-md-6 key-facts">
      <div class="background">
      <ul class="list-group">
        <li class="list-group-item purple"><h4>Key Facts</h4></li>
        <li class="list-group-item"><b>Cause areas:</b>
          {% if profile.cause_areas %}
          {{ profile.cause_areas }}
          {% else %}
          n/a
          {% endif %}
        </li>
        <li class="list-group-item"><b>Expertise:</b>
          {% if profile.expertise %}
          {{ profile.expertise }}
          {% else %}
          n/a
          {% endif %}
        </li>
        <li class="list-group-item"><b>Speaker:</b>
          {% if profile.speaker %}
          {{ profile.speaker }}
          {% else %}
          n/a
          {% endif %}
        </li>
        <li class="list-group-item"><b>Group:</b>
          {% if profile.group %}
          <a href="{% url 'group' profile.group.id %}">{{profile.group.name}}</a>
          {% else %}
          n/a
          {% endif %}
        </li>
        <li class="list-group-item"><b>Skills:</b>
          {% if profile.skills %}
          {{ profile.skills }}
          {% else %}
          n/a
          {% endif %}
        </li>
        <li class="list-group-item"><b>Volunteer:</b>
          {% if profile.volunteer %}
          {{ profile.volunteer }}
          {% else %}
          n/a
          {% endif %}
        </li>
        <li class="list-group-item"><b>Job status:</b>
          {% if profile.job_status %}
          {{ profile.job_status }}
          {% else %}
          n/a
          {% endif %}
        </li>
        <li class="list-group-item"><b>Organisational affiliations:</b>
          {% if profile.org_affiliations %}
          {{ profile.org_affiliations }}
          {% else %}
          n/a
          {% endif %}
        </li>
      </ul>
      </div>
    </div>
    <div class="col-md-6">
        {% include 'eahub/maps/profile_page_map.html' with lat=profile.lat lon=profile.lon %}
    </div>
  </div>
</div>

<br>

<div class="container profile-info">
  <ul class="list-group">
    <li class="list-group-item light-grey"><h4>Bio</h4></li>
    <li class="list-group-item">
      {% if profile.bio %}
        {{ profile.bio }}
      {% else %}
        n/a
      {% endif %}
    </li>
  </ul>
  <br>
  <ul class="list-group">
    <li class="list-group-item light-grey"><h4>Donations</h4></li>
    <li class="list-group-item">
      {% if profile.donations  %}
        <table class="table table-striped table-bordered table-donations">
          <thead>
            <tr>
                <th>To</th>
                <th>Amount</th>
                <th>Date</th>
                <th>Details</th>
            </tr>
          </thead>
          <tbody  id="table_donations">
          </tbody>
        </table>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script>
          var donations = {{ profile.donations | safe }}
          donations = donations.donations
          var table_donations = $("#table_donations")
          donations.forEach(function(donation) {
            var tr = $('<tr>')
            tr.append('<td>' + donation.to + '</td>')
            tr.append('<td>' + donation.amount + '</td>')
            tr.append('<td>' + donation.when + '</td>')
            tr.append('<td>' + donation.details + '</td>')
            table_donations.append(tr)
          })
        </script>
      {% else %}
        <p>n/a</p>
      {% endif %}
    </li>
  </ul>
</div>
{% endblock %}
